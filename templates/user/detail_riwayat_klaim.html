<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Detail Riwayat Klaim | Sistem Lost & Found</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Protest+Strike&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href={{ url_for('static', filename='css/detail_riwayat_klaim.css') }}>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Reddit+Sans+Condensed:wght@700;800&family=Poppins:wght@400;500&display=swap" rel="stylesheet">
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src={{ url_for('static', filename='image/logo injourney.png') }} alt="Logo">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav align-items-center">
          <li class="nav-item"><a class="nav-link active" href="{{ url_for('main.home') }}#hero">Beranda</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.home') }}#statistik">Statistik</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.home') }}#panduan">Panduan</a></li>
          <li class="nav-item"><a class="nav-link" href="#kontak">Kontak</a></li>
          <li class="nav-item ms-lg-3">
            <a href="/login" class="profile-icon"><i class="bi bi-person-circle"></i></a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HEADER -->
  <div class="header-riwayat container-fluid">
    <div class="d-flex align-items-center gap-3">
      <a href="{{ url_for('main.riwayat_klaim') }}" class="back-arrow-header">
        <i class="fa-solid fa-arrow-left"></i>
      </a>
      <h2 class="title-riwayat">Riwayat Klaim Barang</h2>
    </div>

    <img src="{{ url_for('static', filename='image/logo juanda 2.png') }}" alt="Logo Juanda" class="logo-juanda2">
  </div>


  <!-- CONTENT -->
  <section class="container mt-4 pb-4" id="kontenDetail">
    <div class="row g-4">

      <!-- KOLOM KIRI -->
      <div class="col-md-4">
      <div id="infoBarang"
          class="card shadow-sm p-3"
          itemscope
          itemtype="https://schema.org/Product">

          <img src="{{ data.gambar_penemuan }}"
              class="img-fluid rounded"
              alt="Barang"
              itemprop="image">

          <div class="mt-3">
            <p>
              <strong>Nama Barang :</strong>
              <span itemprop="name">{{ data.nama_barang }}</span>
            </p>

            <p>
              <strong>Jenis Laporan :</strong>
              <span itemprop="category">Klaim Barang</span>
            </p>

            <p>
              <strong>Kode Barang :</strong>
              <span itemprop="sku">{{ data.kode_barang }}</span>
            </p>

            <p>
              <strong>Tanggal Klaim :</strong>
              <time itemprop="dateCreated">{{ data.tanggal_lapor }}</time>
            </p>
            <p>
              <strong>Lokasi Penemuan :</strong>
              <time itemprop="dateCreated">{{ data.lokasi }}</time>
            </p>

            <p>
              <strong>Deskripsi :</strong><br>
              <span itemprop="description">{{ data.deskripsi_khusus }}</span>
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="p-3 bg-light-blue rounded shadow-sm mb-3"
            itemscope
            itemtype="https://schema.org/Claim">
          <h5 class="fw-bold mb-3 text-primary" itemprop="name">
            Detail Laporan Terkini
          </h5>

          <p>
            <strong>Kode Kehilangan :</strong>
            <span itemprop="identifier">{{ data.kode_laporan_kehilangan }}</span>
          </p>

          <p>
            <strong>Kode Klaim :</strong>
            <span itemprop="identifier">{{ data.kode_laporan }}</span>
          </p>

          <p>
            <strong>Status :</strong>
            <span itemprop="claimStatus">{{ data.status }}</span>
          </p>

          <p>
            <strong>Catatan Admin :</strong>
            <span itemprop="description">{{ data.catatan_admin }}</span>
          </p>

          <p>
            <strong>Update Terakhir :</strong>
            <time itemprop="dateModified">{{ data.update_terakhir }}</time>
          </p>
        </div>

        <div class="card shadow-sm">
          <table class="table table-bordered text-center align-middle mb-0">
            <thead class="table-header-blue">
              <tr>
                <th>Tanggal</th>
                <th>Status</th>
                <th>Catatan</th>
              </tr>
            </thead>
            <tbody id="tabelStatus"></tbody>
          </table>
        </div>
        
        {% if data.status == 'Verifikasi' %}
        <div class="alert alert-success shadow-sm mt-4">
          <h5 class="fw-bold mb-2">
            <i class="bi bi-check-circle-fill"></i>
            Data sudah dikonfirmasi
          </h5>

          <p class="mb-3">
            Silakan pilih cara pengambilan barang:
          </p>

          <div class="d-flex gap-3 flex-wrap">
            <a href="/download/surat-pengambilan/{{ data.kode_laporan }}?tipe=sendiri"
              class="btn btn-primary">
              <i class="bi bi-person"></i> Ambil Sendiri
            </a>

            <a href="/download/surat-pengambilan/{{ data.kode_laporan }}?tipe=wakil"
              class="btn btn-warning text-dark">
              <i class="bi bi-people"></i> Diwakilkan
            </a>
          </div>

          <hr>

          <small class="text-muted">
            <strong>NB:</strong><br>
            â€¢ Ambil sendiri â†’ membawa fotokopi KTP<br>
            â€¢ Diwakilkan â†’ membawa fotokopi KTP kedua belah pihak
          </small>
        </div>
        {% endif %}
        {% if data.status == 'Verifikasi' and not data.surat_pengambilan %}
        <div class="card shadow-sm mt-4">
          <div class="card-body">
            <h5 class="fw-bold text-primary">
              Upload Surat Pengambilan
            </h5>

            <p class="text-muted">
              Silakan upload surat pengambilan yang sudah diisi dan ditandatangani.
            </p>

            <form
              id="formUploadSurat"
              action="/upload-surat/{{ data.kode_laporan }}"
              method="POST"
              enctype="multipart/form-data"
            >
              <div class="mb-3">
                <input type="file"
                      class="form-control"
                      name="surat"
                      accept=".pdf,.jpg,.jpeg,.png"
                      required>
              </div>

              <button type="submit" class="btn btn-primary">
                <i class="bi bi-upload"></i> Kirim Surat
              </button>
            </form>
          </div>
        </div>
        {% endif %}
        {% if data.status == 'Siap Diambil' %}
        <div class="alert alert-success shadow-sm mt-4">
          <h5 class="fw-bold mb-2">
            <i class="bi bi-check-circle-fill"></i>
            Data sudah dikonfirmasi
          </h5>

          <p class="mb-3">
            Silakan ambil barang Anda maksimal sesuai dengan tanggal pengambilan yang telah ditentukan.
          </p>

          <hr>

          <small class="text-muted">
            <strong>NB:</strong><br>
            â€¢ Ambil sendiri â†’ membawa fotokopi KTP<br>
            â€¢ Diwakilkan â†’ membawa fotokopi KTP kedua belah pihak
          </small>
        </div>
        {% endif %}
        {% if data.status == 'Ditolak' %}
        <div class="alert alert-danger shadow-sm mt-4">
          <h5 class="fw-bold mb-2">
            <i class="bi bi-x-circle-fill"></i>
            Klaim Ditolak
          </h5>

          <p class="mb-2">
            Maaf, data klaim Anda <strong>tidak dapat diproses</strong>. Silakan hubungi petugas Lost & Found untuk informasi lebih lanjut.
          </p>
          {% if data.catatan_admin %}
          <p class="mb-0">
            <strong>Catatan Admin:</strong><br>
            {{ data.catatan_admin }}
          </p>
          {% endif %}
        </div>
        {% endif %}
        {% if data.surat_pengambilan and data.status in ['Verifikasi', 'Siap Diambil', 'Selesai'] %}
          <div class="card mt-4 shadow-sm">
            <div class="card-body">
              <h6 class="fw-bold mb-2">
                <i class="bi bi-file-earmark-pdf-fill text-danger"></i>
                Surat Pengambilan
              </h6>

              <p class="mb-2">
                Nama file:
                <strong>{{ data.surat_pengambilan }}</strong>
              </p>

              <!-- Tombol buka di tab baru -->
              <a href="{{ url_for('static', filename='uploads/surat/' ~ data.surat_pengambilan) }}"
                target="_blank"
                class="btn btn-sm btn-outline-primary mb-3">
                <i class="bi bi-eye"></i> Buka di Tab Baru
              </a>

              <!-- PREVIEW PDF DI HALAMAN -->
              <iframe
                src="{{ url_for('static', filename='uploads/surat/' ~ data.surat_pengambilan) }}"
                width="100%"
                height="600px"
                style="border:1px solid #ddd; border-radius:8px;">
              </iframe>
            </div>
          </div>
        {% endif %}
      </div>

    </div>
  </section>

  <!-- Footer -->
  <section class="footer" id="kontak">
    <footer class="footer text-white" id="kontak">
      <div class="footer-container">
        <div class="footer-top">
          <!-- Logo di pojok kiri -->
          <div class="footer-logo">
            <img src={{ url_for('static', filename='image/logo putih.png')}} alt="InJourney Airports">
          </div>

          <!-- Alamat -->
          <div class="footer-address">
            <p>Jl. Juanda, Segoro Tambak, Kec. Sedati,<br>
            Kabupaten Sidoarjo, Jawa Timur 61253 - Indonesia</p>
          </div>

          <!-- Kontak Center -->
          <div class="footer-contact">
            <p><strong>Contact Center :</strong> @ccinjourneyairports</p>
            <p>ðŸ“ž 172 &nbsp; | &nbsp; ðŸ“§ cc172@injourneyairports.id</p>
            <p>Ph : T1 (+62 31 2986200) &nbsp; | &nbsp; T2 (+62 31 2986700)</p>
          </div>

          <!-- Ikon Sosial di pojok kanan -->
          <div class="footer-icons">
            <a href="tel:(0623)12986200" class="text-white"><i class="fas fa-phone"></i></a>
            <a href="mailto:humas.sub@ap1.co.id" class="text-white"><i class="fas fa-envelope"></i></a>
            <a href="https://www.instagram.com/juanda_airport" target="_blank" class="text-white"><i class="fab fa-instagram"></i></a>
          </div>
        </div>

        <hr class="footer-divider">

        <!-- Copyright -->
        <div class="footer-bottom text-center small">
          Â© 2025 PT. ANGKASA PURA | BANDARA INTERNASIONAL JUANDA
        </div>
      </div>
    </footer>
  </section>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src={{ url_for('static', filename='js/detail_riwayat_klaim.js') }}></script>
</body>
</html>
