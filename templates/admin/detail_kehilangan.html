<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kehilangan - Detail Laporan Barang</title>

  <link rel="stylesheet" href="{{ url_for('admin_bp.static', filename='css/detail_kehilangan.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>

<div class="sidebar">
  <div>
    <div class="logo-wrapper">
      <img src="{{ url_for('admin_bp.static', filename='image/rectangle.png') }}" class="rectangle-bg">
      <img src="{{ url_for('admin_bp.static', filename='image/logo.png') }}" class="logo-front">
    </div>

    <nav>
      <a href="{{ url_for('admin_bp.beranda_admin') }}">
        <i class="bi bi-speedometer2"></i> Beranda
      </a>

      <a href="#" class="active">
        <i class="bi bi-question-circle"></i> Kehilangan
      </a>

      <div class="submenu">
        <a href="{{ url_for('admin_bp.daftar_kehilangan') }}" class="active">
          <i class="bi bi-list-ul"></i> Daftar Barang
        </a>
        <a href="{{ url_for('admin_bp.tambah_kehilangan') }}">
          <i class="bi bi-plus-circle"></i> Tambah
        </a>
      </div>

      <a href="{{ url_for('admin_bp.daftar_penemuan') }}">
        <i class="bi bi-archive"></i> Penemuan
      </a>

      <a href="{{ url_for('admin_bp.arsip') }}">
        <i class="bi bi-folder"></i> Arsip
      </a>

      <a href="{{ url_for('admin_bp.pengaturan') }}">
        <i class="bi bi-gear"></i> Pengaturan
      </a>
    </nav>
  </div>

  <a href="{{ url_for('admin_bp.logout_admin') }}" class="logout">
    <i class="bi bi-box-arrow-right"></i> Logout
  </a>
</div>

<div class="content">
  <div class="header">
    <div class="logo-wrapper">
      <img src="{{ url_for('admin_bp.static', filename='image/rectangle2.png') }}" class="rectangle-bg">
      <img src="{{ url_for('admin_bp.static', filename='image/image5.png') }}" class="logo-front">
    </div>

    <h2>Detail Laporan Kehilangan</h2>

    <div class="profile-icon"
         onclick="window.location.href='{{ url_for('admin_bp.pengaturan') }}'"
         style="cursor:pointer;">
      {% if global_admin and global_admin.photo %}
        <img src="{{ url_for('admin_bp.static', filename='upload/' ~ global_admin.photo) }}"
             class="profile-header-img">
      {% else %}
        <i class="bi bi-person-circle"></i>
      {% endif %}
    </div>
  </div>

  <div class="detail-container">

    <div class="left-panel text-center">
      <img
        id="fotoBarang"
        class="foto-barang"
        src="{{ url_for('static', filename='uploads/' ~ (laporan.foto if laporan.foto else 'placeholder.png')) }}"
        alt="Foto Barang">

      <div id="kodeLaporan" class="kode-laporan">
        {{ laporan.kode_kehilangan }}
      </div>
    </div>

    <div class="right-panel">

      <div class="data-section">
        <h3>Data Pelapor</h3>
        <div class="data-row"><span>Nama :</span><strong>{{ laporan.nama_pelapor }}</strong></div>
        <div class="data-row"><span>No. Telp :</span><strong>{{ laporan.no_telp }}</strong></div>
        <div class="data-row"><span>Email :</span><strong>{{ laporan.email }}</strong></div>
        <div class="data-row"><span>Asal Negara :</span><strong>{{ laporan.asal_negara }}</strong></div>
        <div class="data-row"><span>Kota :</span><strong>{{ laporan.kota }}</strong></div>
      </div>

      <div class="data-section">
        <h3>Data Barang</h3>
        <div class="data-row"><span>Nama Barang :</span><strong>{{ laporan.nama_barang }}</strong></div>
        <div class="data-row"><span>Kategori :</span><strong>{{ laporan.kategori }}</strong></div>
        <div class="data-row"><span>Jenis Laporan :</span><strong>{{ laporan.jenis_laporan }}</strong></div>
        <div class="data-row"><span>Lokasi :</span><strong>{{ laporan.lokasi }}</strong></div>
        <div class="data-row"><span>Deskripsi :</span><strong>{{ laporan.deskripsi }}</strong></div>
        <div class="data-row">
          <span>Catatan :</span>
          <textarea id="catatanAdmin" class="form-control" rows="3" placeholder="Masukkan catatan...">{{ laporan.catatan if laporan.catatan else '' }}</textarea>
        </div>
      </div>

      <div class="data-section">
        <h3>Waktu & Status</h3>

        <div class="data-row">
          <span>Tanggal Kehilangan :</span>
          <strong>{{ laporan.tanggal_kehilangan }}</strong>
        </div>

        <div class="data-row">
          <span>Tanggal Submit :</span>
          <strong>{{ laporan.tanggal_submit }} {{ laporan.waktu_submit }}</strong>
        </div>

        <div class="data-row">
          <span>Update Terakhir :</span>
          <strong id="updateTerakhir">{{ laporan.update_terakhir }}</strong>
        </div>

        <div class="data-row">
          <span>Status :</span>
          <select id="status" class="status-select">
            <option value="Pending" {% if laporan.status == 'Pending' %}selected{% endif %}>Pending</option>
            <option value="Verifikasi" {% if laporan.status == 'Verifikasi' %}selected{% endif %}>Verifikasi</option>
            <option value="Dalam Pencarian" {% if laporan.status == 'Dalam Pencarian' %}selected{% endif %}>Dalam Pencarian</option>
            <option value="Dalam Proses" {% if laporan.status == 'Dalam Proses' %}selected{% endif %}>Dalam Proses</option>
            <option value="Barang Tidak Ditemukan" {% if laporan.status == 'Barang Tidak Ditemukan' %}selected{% endif %}>Barang Tidak Ditemukan</option>
            <option value="Selesai" {% if laporan.status == 'Selesai' %}selected{% endif %}>Selesai</option>
          </select>
        </div>
      </div>

      <div class="foto-penemuan-section no-print">
        <h4>Barang Rekomendasi (Foto Penemuan H-1, H, H+1)</h4>

        <div class="filter-wrapper">
          <input
            type="text"
            id="filterFoto"
            class="filter-input"
            placeholder="Cari ciri barang (contoh: jam tangan hitam)">

          <button
            id="btnCariFoto"
            class="btn btn-primary btn-sm">
            Cari
          </button>
        </div>

        <p id="infoCari" class="text-muted">
          Ketik kata kunci lalu klik <strong>Cari</strong> untuk menampilkan foto penemuan.
        </p>

        <div class="foto-penemuan-list hidden" id="fotoPenemuanList">
          {% for f in foto_penemuan %}
            <div class="foto-item selectable"
                data-id="{{ f.kode_barang }}"
                data-nama="{{ f.nama_barang|lower }}">

              <input type="checkbox"
                    class="select-foto"
                    value="{{ f.kode_barang  }}">

              <img src="{{ url_for('static', filename='uploads/' ~ f.gambar_barang) }}"
                  alt="Foto Penemuan">

              <small>
                {{ f.nama_barang }}<br>
                {{ f.tanggal_lapor }}
              </small>
            </div>
          {% endfor %}
        </div>
      </div>

      <button id="btnSimpanRekomendasi" class="btn btn-success mt-3">
        Simpan Rekomendasi
      </button>


      <div class="button-group no-print">
        <button id="btnKembali" class="btn btn-secondary">
          Kembali
        </button>

        <button
          id="btnUpdate"
          class="btn btn-primary"
          data-kode="{{ laporan.kode_kehilangan }}"
          data-jenis="kehilangan">
          Update Status
        </button>

        <button id="btnExportPdf" class="btn btn-success">
          <i class="bi bi-file-earmark-pdf"></i> Export PDF
        </button>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script src="{{ url_for('admin_bp.static', filename='js/detail_kehilangan.js') }}"></script>
<script src="{{ url_for('admin_bp.static', filename='js/logout.js') }}"></script>

</body>
</html>
